<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Edit Book - Cornerstone Books</title>
    <link rel="stylesheet" href="/styles.css">
</head>
<body>
    <nav class="nav">
        <div class="container nav-container">
            <a href="/" class="logo">Cornerstone Books</a>
            <div class="nav-links">
                <a href="/">Home</a>
                <a href="/pages/publications.html">Publications</a>
                <a href="/pages/about.html">About</a>
                <a href="/pages/contact.html">Contact</a>
                <a href="/pages/admin.html" class="admin-link active">Admin</a>
            </div>
        </div>
    </nav>

    <main>
        <div class="section">
            <div class="container">
                <a href="/pages/admin.html" class="btn btn-ghost mb-4">‚Üê Back to Dashboard</a>
                
                <h1 class="section-title">Edit Book</h1>
                
                <form class="book-form" id="editBookForm" enctype="multipart/form-data">
                    <div class="form-group">
                        <label class="form-label">Cover Image</label>
                        <div class="image-upload" id="imageUpload">
                            <input type="file" id="coverImage" name="coverImage" accept="image/*">
                            <p>Click to upload new image or drag and drop</p>
                            <p style="font-size: 0.875rem; color: var(--color-muted-foreground);">Leave empty to keep current image</p>
                        </div>
                        <div id="imagePreview" class="image-preview"></div>
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="title">Title *</label>
                        <input type="text" id="title" name="title" class="form-input" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="author">Author *</label>
                        <input type="text" id="author" name="author" class="form-input" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="publicationDate">Publication Date *</label>
                        <input type="text" id="publicationDate" name="publicationDate" class="form-input" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="synopsis">Synopsis *</label>
                        <textarea id="synopsis" name="synopsis" class="form-textarea" required></textarea>
                    </div>

                    <div style="display: flex; gap: 1rem;">
                        <button type="submit" class="btn btn-secondary btn-lg">Update Book</button>
                        <a href="/pages/admin.html" class="btn btn-ghost btn-lg">Cancel</a>
                    </div>
                </form>
            </div>
        </div>
    </main>

    <footer class="footer">
        <div class="container footer-content">
            <div class="footer-section">
                <h3 class="footer-title">Cornerstone Books</h3>
                <p class="footer-text">An independent bookstore curating exceptional literary works for discerning readers.</p>
            </div>
            <div class="footer-section">
                <h4 class="footer-heading">Quick Links</h4>
                <div class="footer-links">
                    <a href="/pages/publications.html">Publications</a>
                    <a href="/pages/about.html">About</a>
                    <a href="/pages/contact.html">Contact</a>
                </div>
            </div>
            <div class="footer-section">
                <h4 class="footer-heading">Visit Us</h4>
                <p class="footer-text">123 Literary Lane<br>New York, NY 10001</p>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2024 Cornerstone Books. All rights reserved.</p>
        </div>
    </footer>

    <script>
        const params = new URLSearchParams(window.location.search);
        const bookId = params.get('id');
        let currentBook = null;
        
        if (!bookId) {
            window.location.href = '/pages/admin.html';
        } else {
            fetch(`/api/books/${bookId}`)
                .then(res => res.json())
                .then(book => {
                    currentBook = book;
                    document.getElementById('title').value = book.title;
                    document.getElementById('author').value = book.author;
                    document.getElementById('publicationDate').value = book.publicationDate;
                    document.getElementById('synopsis').value = book.synopsis;
                    document.getElementById('imagePreview').innerHTML = `<img src="${book.coverImage}" alt="Current cover">`;
                })
                .catch(() => {
                    alert('Book not found');
                    window.location.href = '/pages/admin.html';
                });
        }

        const imageUpload = document.getElementById('imageUpload');
        const coverImageInput = document.getElementById('coverImage');
        const imagePreview = document.getElementById('imagePreview');
        
        imageUpload.onclick = () => coverImageInput.click();
        
        coverImageInput.onchange = (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (event) => {
                    imagePreview.innerHTML = `<img src="${event.target.result}" alt="Preview">`;
                };
                reader.readAsDataURL(file);
            }
        };

        document.getElementById('editBookForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            
            try {
                const response = await fetch(`/api/books/${bookId}`, {
                    method: 'PUT',
                    body: formData
                });
                
                if (response.ok) {
                    alert('Book updated successfully!');
                    window.location.href = '/pages/admin.html';
                } else {
                    const error = await response.json();
                    alert('Error: ' + (error.message || 'Failed to update book'));
                }
            } catch (err) {
                alert('Error updating book');
                console.error(err);
            }
        });
    </script>
</body>
</html>
